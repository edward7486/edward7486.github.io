<!DOCTYPE html>
<html lang="en">
 	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Interactive Map: Venture Capital</title>

		<!-- Bootstrap -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
		  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
		<style type="text/css">

			div.tooltip {   
				position: absolute;                     
				width: 150px;                  
				height: 120px;                 
				padding: 10px;             
				font: 12px sans-serif;        
				background: #333333;   
				color: white;                
				pointer-events: none;         
			}

			.axis path,
			.axis line {
				fill: none;
				stroke-width: 2px;
		        stroke: gray;
		        shape-rendering: crispEdges;
			}

			.axis text {
				color: #333333;
				font-family: sans-serif;
				font-size: 15px;
			}

			.xlabel {
				font-family: sans-serif;
				font-size: 1.2em;
				color: #333333;
			}

			.scrollable-menu {
			    height: auto;
			    max-height: 200px;
			    overflow-x: hidden;
			}

			#filters {
				position: relative;
				top: -10px;
			}

			#sortHP {
				margin-top: 4px;
			}

		</style>
	</head>
	<body>
		<div class="container">

    		<h1>93 Cars from 1993</h1>

    		<hr />

    		<div class="row">
    			<div class="col-md-1"><h4>Filters:</h4></div>
    			<div class="col-md-2">
					<div id="manu">
						<select>
							<option>Select Maker</option>
							<option value="Acura">Acura</option>
							<option value="Audi">Audi</option>
							<option value="BMW">BMW</option>
							<option value="Buick">Buick</option>
							<option value="Cadillac">Cadillac</option>
							<option value="Chevrolet">Chevrolet</option>
							<option value="Chrysler">Chrysler</option>
							<option value="Dodge">Dodge</option>
							<option value="Eagle">Eagle</option>
							<option value="Ford">Ford</option>
							<option value="Geo">Geo</option>
							<option value="Honda">Honda</option>
							<option value="Hyundai">Hyundai</option>
							<option value="Infiniti">Infiniti</option>
							<option value="Lexus">Lexus</option>
							<option value="Lincoln">Lincoln</option>
							<option value="Mazda">Mazda</option>
							<option value="Mercedes-Benz">Mercedes-Benz</option>
							<option value="Mercury">Mercury</option>
							<option value="Mitsubishi">Mitsubishi</option>
							<option value="Nissan">Nissan</option>
							<option value="Oldsmobile">Oldsmobile</option>
							<option value="Plymouth">Plymouth</option>
							<option value="Pontiac">Pontiac</option>
							<option value="Saab">Saab</option>
							<option value="Saturn">Saturn</option>
							<option value="Subaru">Subaru</option>
							<option value="Suzuki">Suzuki</option>
							<option value="Toyota">Toyota</option>
							<option value="Volkswagen">Volkswagen</option>
							<option value="Volvo">Volvo</option>
						</select>
					</div>
				</div>
				<div class="col-md-2">
					<div id="filters">

						<div class="radio">
							<label><input type="radio" name="airbags" id="airbag" value="airbag" unchecked>Has Airbags</label>
						</div>
						<div class="radio">
							<label><input type="radio" name="airbags" id="no-airbag" value="no-airbag" unchecked>No Airbags</label>
						</div>
					</div>
				</div>
				<div class="col-md-2">
					<button type="button" class="btn btn-default btn-sm" id="sortPrice">Sort by Price</button>
					<button type="button" class="btn btn-default btn-sm" id="sortHP">Sort by Horsepower</button>
				</div>
				<div class="col-md-2">
					<button type="button" class="btn btn-danger btn-sm" id="clearfilter">Clear All Filters</button></p>
				</div>
			</div>

			<div id="map"></div>

		</div>

		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
		<!-- Include all compiled plugins (below), or include individual files as needed -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
		<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<script type="text/javascript">

		// Variables //

		var w = 1440;
		var h = 500;

		var tooltip = d3.select("body").append("div")   
			.attr("class", "tooltip")               
			.style("opacity", 0);					

		// Draw Canvas and Circles //

		d3.json("cars.json", function(data) {

			// Create initial X-Scale //

			var xScale = d3.scale.linear()
					.domain([ 0 , d3.max(data, function(d){return d.Horsepower;} ) ])
					.range([ 0 , 1100 ]);

			// Create X-Axis //

			var xAxis = d3.svg.axis()
					.scale(xScale)
					.orient("bottom")
					.ticks(10);

			// Create Svg Canvas //
					
    		var svg = d3.select("#map")
		    		.append("svg")
		    		.attr("height", h)
		    		.attr("width", w)
		    		.append("g")
		    			.attr("transform", "translate(10, -200)");	

			// Create Circles //	

			var circles = svg.selectAll("circle")
					.data(data)
					.enter()
					.append("circle");

			// X-Axis Label //

			var xLabel = svg.append("text")
					.attr("x", 500)
					.attr("y", 550)
					.attr("class", "xlabel")
					.text("HORSEPOWER");

			// Call & Group + Translate x-Axis Down Under axes //

			svg.append("g")
				.call(xAxis)
				.attr("class", "axis")
				.attr("transform", "translate(0, 500)");

			// Circle Draw //

			circles
					.attr("cx", function(d){ return xScale(d.Horsepower) ; })
					.attr("cy", 400)
					.attr("r", 8)
					.attr("fill", "steelblue")
					.style("opacity", 0.8)

					// Mouseover for Tooltip //
					.on("mouseover", function(d) {      
			            tooltip
			            	.transition()        
				                .duration(500)      
				                .style("opacity", .96)
				                d3.select(this).attr("stroke", "black");   
			            tooltip
			            	.html(
				            	"<strong>" + d.Manufacturer + " " + d.Model + "</strong>" + "<br /><br />" +
				            	"Price: " + d.Price + "k" + "<br />" + 
				            	"Horsepower: " + d.Horsepower + "<br />" + 
				            	"MPG City: " + d.MPG_city + "<br />" +
				            	"MPG Highway: " + d.MPG_highway + "<br />" +  
				            	"Engine Size: " + d.EngineSize + "<br />"
				            	)  
				                .style("left", (d3.event.pageX) + "px")     
				                .style("top", (d3.event.pageY - 140) + "px"); 
			            })

		            // Mouseout //                   
			        .on("mouseout", function(d) {       
			            tooltip.transition()        
			                .duration(500)      
			                .style("opacity", 0)
			                d3.select(this).attr("stroke", "none");   
			        })	

			// Airbag Filters //

			d3.selectAll("input[name='airbags']")
				.on("change", function(){

				    if (document.getElementById('airbag').checked) {
				    	circles
				    		.attr("fill", "steelblue")
				    		.attr("r", 10)
							.data(data)
							.transition("elastic")
							.filter(function(d){ return d.AirBags != "None";})
								.attr("fill", "green")
								.attr("r", 15)
								.duration(800);
				    } else if (document.getElementById('no-airbag').checked) {
				    	circles
				    		.attr("fill", "steelblue")
				    		.attr("r", 10)
				    		.data(data)
							.transition("elastic")
							.filter(function(d){ return d.AirBags == "None";})
								.attr("fill", "#FF5200")
								.attr("r", 15)
								.duration(800);
				    }
			})

			// Sort by Price //

			d3.selectAll("#sortPrice")
				.on("click", function(){
					xScale
						.domain([ 0 , d3.max(data, function(d){return d.Price;} ) ])
						.range([ 0 , 1100 ])
					xAxis
						.scale(xScale)
						.orient("bottom")
						.ticks(10)
					xLabel
						.text("PRICE (in thousands)")
					svg.select("g.axis")
        				.call(xAxis)
					circles
						.transition()
						.attr("cx", function(d){ return xScale(d.Price) ; })
						.duration(1000);
			})	

			// Sort by HP //

			d3.selectAll("#sortHP")
				.on("click", function(){
					xScale
						.domain([ 0 , d3.max(data, function(d){return d.Horsepower;} ) ])
						.range([ 0 , 1100 ])
					xAxis
						.scale(xScale)
						.orient("bottom")
						.ticks(10)
					xLabel
						.text("HORSEPOWER")
					svg.select("g.axis")
        				.call(xAxis)
					circles
						.transition()
						.attr("cx", function(d){ return xScale(d.Horsepower) ; })
						.duration(1000);
			})	

			// Reset All Filter //

			d3.selectAll("#clearfilter")
				.on("click", function(){
					document.getElementById("airbag").checked = false,
					document.getElementById("no-airbag").checked = false,
					xScale
						.domain([ 0 , d3.max(data, function(d){return d.Horsepower;} ) ])
						.range([ 0 , 1100 ])
					xAxis
						.scale(xScale)
						.orient("bottom")
						.ticks(10)
					xLabel
						.text("HORSEPOWER")
					svg.select("g.axis")
        				.call(xAxis)
					circles
						.transition()
						.attr("cy", 400)
						.attr("cx", function(d){ return xScale(d.Horsepower) ; })
						.attr("fill", "steelblue")
						.attr("r", "10")
						.attr("stroke", "none")
						.duration(1000);
			})	

			// Manufacturer Select //

			d3.select("select").on("change", function(data) {
				var car = d3.select(this).property('value');
			    	circles
			    		.transition()
			    		.duration(500)
			    		.attr("cy", 400)
			    		.attr("stroke", "none")
						.attr("stroke-width", "0")
			    		.attr("z-index", "500")
						.transition()
						.filter(function(d){ return d.Manufacturer == car;})
							.transition()
							.attr("cy", "300")
							.duration(800);

			});

		});

		</script>
	</body>
</html>